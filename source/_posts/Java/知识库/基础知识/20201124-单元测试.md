---
categories:
  - Java
  - 知识库
  - Java
---
**单元测试**

单元测试是指对软件中的**最小可测单元**进行检查和验证；

根据测试金字塔原理，越往上层的测试，所需测试投入比例越大，效果也越差。单测成本小，且更容易发现问题。（效果：单元测试 > 集成测试 > UI测试）



**分层测试**

Service => Biz层 => （外部服务访问层、DAO层、Redis访问层）

每一层均使用mock 框架屏蔽下层的具体实现。



**单元测试过程**

数据准备 => 构造参数（+打桩）=> 执行测试 => 结果验证 => 清理（必要）

1. 数据准备：测试用例需要依赖一些数据，数据来源一般是数据库，而又不能依赖DAO层的代码，需要使用原生jdbc去插入数据，**测试代码编写效率低**
2. 构造参数：入参赋值（**代码行数多**）
3. 执行测试：直接调用被测方法
4. 结果验证：验证方法的返回值、数据库数据是否正确、某外部方法是否被调用过n次等
5. 必要的清理：对打桩进行清理、对数据库脏数据进行清理



**痛点**

1. 重构代码需要改写大量单元测试用例
   1. 大量的Service 层单元测试,biz层单元测试都要重写；有时候Service调用biz层接口时，参数传错了，而由于开发人员编写单元测试时不规范，参数匹配使用了 anyxxx()，导致参数传错的bug未被发现。
2. 测试库数据随意修改导致的单元测试不稳定
   1. DAO层单元测试直连测试库，由于测试库的数据可以被任意修改，从而导致测试依赖的数据被更改，单元测试不通过，另外开发在编写单元测试时，没有清理意识，导致测试库大量垃圾数据。
3. 单元测试结果校验缺失
   1. 例如一个SaveItem()接口，执行完成后除了要验证执行成功以外，还应该验证落库数据的正确性，而编写这部分测试代码需要大量的使用原生jdbc 接口查询sql，并逐字段验证正确性，代码编写效率低下。





**参考文章**-《有赞单元测试实践》

https://tech.youzan.com/youzan-test-practice/

