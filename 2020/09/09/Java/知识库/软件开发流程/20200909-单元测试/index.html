<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta name="referrer" content="no-referrer" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-material.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"huangyuye.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="如何进行单元测试单元测试”称为“开发阶段的自动化测试“。   由开发同学完成 测试是自动化的 不一定是只验证一个“单元”的正确性  单元测试在市面上的介绍存在的问题  仅集中在介绍某个工具或者框架怎么用（比如JUnit，mockito，jest等） 一些理论上的对这种测试好处的介绍，通篇是“应该做测试”，“这么做了就容易得到高内聚的代码“ 只拿“纯函数”的测试举例子，几乎没有复杂的依赖（无法贴合实">
<meta property="og:type" content="article">
<meta property="og:title" content="单元测试">
<meta property="og:url" content="https://huangyuye.github.io/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/index.html">
<meta property="og:site_name" content="好家伙">
<meta property="og:description" content="如何进行单元测试单元测试”称为“开发阶段的自动化测试“。   由开发同学完成 测试是自动化的 不一定是只验证一个“单元”的正确性  单元测试在市面上的介绍存在的问题  仅集中在介绍某个工具或者框架怎么用（比如JUnit，mockito，jest等） 一些理论上的对这种测试好处的介绍，通篇是“应该做测试”，“这么做了就容易得到高内聚的代码“ 只拿“纯函数”的测试举例子，几乎没有复杂的依赖（无法贴合实">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-09-09T00:00:00.000Z">
<meta property="article:modified_time" content="2021-05-24T11:21:09.392Z">
<meta property="article:author" content="yuye.Huang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://huangyuye.github.io/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>单元测试 | 好家伙</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="好家伙" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">好家伙</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Coder.Huang</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://huangyuye.github.io/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="yuye.Huang">
      <meta itemprop="description" content="想要成为酷酷的软件开发者">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="好家伙">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          单元测试
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-09 00:00:00" itemprop="dateCreated datePublished" datetime="2020-09-09T00:00:00+00:00">2020-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-24 11:21:09" itemprop="dateModified" datetime="2021-05-24T11:21:09+00:00">2021-05-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">知识库</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">软件开发流程</span></a>
                </span>
            </span>

          <br>

          
            <span id="/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-meta-item leancloud_visitors" data-flag-title="单元测试" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.9k</span> <!-- TODO func undefined -->
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="如何进行单元测试"><a href="#如何进行单元测试" class="headerlink" title="如何进行单元测试"></a>如何进行单元测试</h2><p><strong>单元测试”称为“开发阶段的自动化测试“。</strong></p>
<ol>
<li> 由开发同学完成</li>
<li>测试是自动化的</li>
<li>不一定是只验证一个“单元”的正确性</li>
</ol>
<p><strong>单元测试在市面上的介绍存在的问题</strong></p>
<ol>
<li>仅集中在介绍某个工具或者框架怎么用（比如JUnit，mockito，jest等）</li>
<li>一些理论上的对这种测试好处的介绍，通篇是“应该做测试”，“这么做了就容易得到高内聚的代码“</li>
<li>只拿“纯函数”的测试举例子，几乎没有复杂的依赖（无法贴合实际项目：业务逻辑、数据分析的job代码）<ol>
<li>函数的输入就是其所有可见的上下文了。对于一个纯函数，开发者者很容易构造其<strong>上下文</strong>。</li>
</ol>
</li>
<li><strong>很少有关于真正为什么这个事情难以落地的讨论</strong></li>
</ol>
<p><strong>实践起来常见问题</strong></p>
<ol>
<li>没想明白要验证什么</li>
<li>对依赖的处理方式的拿捏是测试里最难的地方。（对不纯的依赖都要尽量mock）<ol>
<li>比如：验证一个下单打折的函数是否能计算出正确的折扣，往往先要从DB获取折扣数据(依赖)，才能做计算。</li>
<li>如果mock掉这个DB查询的依赖，那这个单元测试的假设是：<strong>“读取折扣的SQL本身是肯定没错的，因此不验证它，只验证读到折扣数据后，根据输入金额得到折扣金额的逻辑是正确的“</strong></li>
<li>如果不mock掉DB查询的依赖，即使用真的生产DB做验证，这里测试的目标就从“<strong>验证计算折扣的逻辑</strong>”变成“<strong>验证计算折扣这个功能是否正确</strong>“。<ol>
<li>這裏已经不是“单元”了，而是一个函数 + 一句SQL执行 + DB功能正确的（局部）“集成”测试，是几个组件一起测试才能实现这个验证。这样的测试代价是必须部署一个真的数据库，还要准备数据和<strong>后门</strong>。</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>到底要不要做”局部集成测试“而非实际的单元测试？</strong></p>
<ul>
<li>你的目标就是要测“一小段代码是不是正确”。你可以很有信心的保证其他依赖的正确性都能保证。那明显，这时就不用花精力做集成了。怎么简单怎么来。这样的测试甚至都不需要启动Spring这类框架，运行速度会很快。</li>
<li>你在开发一个小的lib。这个lib就很纯，没有任何复杂的依赖，那么单元测试就足够了。</li>
<li>如果团队已经安排了专人做这块的集成测试，开发人员就没必要做重复劳动了。如果这块测试的不好，应该优先去和那个测试同学沟通，看看怎么改善。沟通无效，在manager知情和同意下，再自己补。</li>
<li>如果开发自己做集成可以更容易构造全集成，而测试不太容易构造的例子，那么还是自己集成测试一下比较好。性价比高。</li>
<li>如果是要测试一个端到端的接口返回正确，那么唯一的办法就是集成测试——真的启动server，使用真的数据库、Redis、队列……，做端到端的测试。这时也许docker可以帮助你一键启动全套环境。</li>
<li>如果一个测试涉及到依赖的核心功能，也必须得做集成测试。比如要测试一个Exception是不是会让当前事务真的回滚，同时发生的其他事务因为隔离级别不会受到影响，那么你必须引入真的，和生产一模一样的支持事务的数据库才行。</li>
<li>如果是前端测试，基本上也必须得做集成测试。就算可以mock掉所有的后端接口，也得引入浏览器或者App框架才能测试。</li>
</ul>
<p><strong>单元测试目的</strong></p>
<p>验证“自己写的一小段代码是不是符合设计逻辑的“。</p>
<p><strong>单元测试的出发点</strong></p>
<p>开发人员为了保证代码质量应该怎样做</p>
<p><strong>单元测试怎么做？</strong></p>
<ul>
<li>确定测试的目标，到底想验证什么</li>
<li>基于这个目标，找到和维护需要的工具，比如Runner，Mock，覆盖率统计工具等，Embedded数据库等</li>
<li>留足给测试的时间，并通过code review的手段来保证写有效的测试</li>
<li>给一些典型的场景如何做测试写一写文档，积累经验（比如如何测试要模拟时间的案例？）</li>
<li>统计测试同学给开发同学报bug的数据，盯紧代码质量不高的同学，多做沟通</li>
<li>根据出现bug的数量和scope来推动部分关键代码的测试质量的改善</li>
<li>在能达成测试目标的前提下，看看能够整合一些工具，降低维护测试依赖的成本</li>
</ul>
<p><strong>单元测试的好处</strong></p>
<ol>
<li>让你写出更好的代码：只有高内聚、低耦合而且接口设计合理的代码才易于测试；</li>
<li>让你在修改代码时更有信心。</li>
</ol>
<h2 id="单元测试概念"><a href="#单元测试概念" class="headerlink" title="单元测试概念"></a>单元测试概念</h2><h3 id="单元测试框架"><a href="#单元测试框架" class="headerlink" title="单元测试框架"></a>单元测试框架</h3><h4 id="junit"><a href="#junit" class="headerlink" title="junit"></a>junit</h4><p>基本框架</p>
<h4 id="testNG"><a href="#testNG" class="headerlink" title="testNG"></a>testNG</h4><p>可以很容易地编写自定义测试。</p>
<p>如果您拥有执行测试所需的测试数据，TestNG可以轻松获取要编写单元测试的测试数据。</p>
<h3 id="模拟框架"><a href="#模拟框架" class="headerlink" title="模拟框架"></a>模拟框架</h3><h4 id="EasyMock"><a href="#EasyMock" class="headerlink" title="EasyMock"></a>EasyMock</h4><p>Mockito的替代品</p>
<ol>
<li>录制：EasyMock.expect(mock.someMethod())</li>
<li>执行：EasyMock.replay(mock)</li>
<li>验证期望：EasyMock.verify(mock)</li>
</ol>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<h4 id="Mockito-amp-JMockit"><a href="#Mockito-amp-JMockit" class="headerlink" title="Mockito &amp; JMockit"></a>Mockito &amp; JMockit</h4><ol>
<li><h1 id="先进行Stub：when-mock-someMethod-then"><a href="#先进行Stub：when-mock-someMethod-then" class="headerlink" title="先进行Stub：when(mock.someMethod()).then()"></a>先进行Stub：when(mock.someMethod()).then()</h1><h4 id="Mockito-Vs-JMockit"><a href="#Mockito-Vs-JMockit" class="headerlink" title="Mockito Vs JMockit"></a>Mockito Vs JMockit</h4></li>
</ol>
<ol>
<li><p>Stub：when(mock.someMethod()).then()</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>1bd18958d9aa8a5bf6a3acce872ed9d752807f29</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</li>
<li><p>验证行为：verify(mock).someMethod()</p>
</li>
</ol>
<h4 id="PowerMock"><a href="#PowerMock" class="headerlink" title="PowerMock"></a>PowerMock</h4><p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>用于模拟复杂场景<br>=======<br>模拟复杂场景</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>1bd18958d9aa8a5bf6a3acce872ed9d752807f29</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>想要模拟静态方法、构造函数和私有方法时，Powermock非常有用。</p>
<h3 id="结合项目框架使用的mock框架"><a href="#结合项目框架使用的mock框架" class="headerlink" title="结合项目框架使用的mock框架"></a>结合项目框架使用的mock框架</h3><p>Spring 有 Spring Test、Spring MVC Test</p>
<h3 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h3><h4 id="AssertJ-Hamcrest"><a href="#AssertJ-Hamcrest" class="headerlink" title="AssertJ / Hamcrest"></a>AssertJ / Hamcrest</h4><p>Hamcrest提供了AssertJ的替代方案来编写断言。</p>
<h3 id="Spring-Unit"><a href="#Spring-Unit" class="headerlink" title="Spring Unit"></a>Spring Unit</h3><p>Web层- Spring MockMVC</p>
<p>数据层- DataJpaTest</p>
<p>业务层-基于Mockito的测试，最好不要启动Spring Context</p>
<h3 id="断言JSON响应"><a href="#断言JSON响应" class="headerlink" title="断言JSON响应"></a>断言JSON响应</h3><h4 id="JSONAssert-JSONPath"><a href="#JSONAssert-JSONPath" class="headerlink" title="JSONAssert / JSONPath"></a>JSONAssert / JSONPath</h4><h3 id="测试覆盖率"><a href="#测试覆盖率" class="headerlink" title="测试覆盖率"></a>测试覆盖率</h3><p>Cobertura</p>
<h3 id="jenkins"><a href="#jenkins" class="headerlink" title="jenkins"></a>jenkins</h3><p>利用 jenkins 等持续集成工具定时/有代码变更时运行单元测试，保证修改不会破坏已有的代码功能。</p>
<h3 id="Test-Doubles：Fakes、Mocks-以及-Stubs"><a href="#Test-Doubles：Fakes、Mocks-以及-Stubs" class="headerlink" title="Test Doubles：Fakes、Mocks 以及 Stubs"></a>Test Doubles：Fakes、Mocks 以及 Stubs</h3><p><strong>double：</strong>极相似的对应物</p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>double存在的意义：用来对系统(或者将粒度放小为模块，单元)进行隔离<br>=======<br>用来对系统(或者将粒度放小为模块，单元)进行隔离</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>1bd18958d9aa8a5bf6a3acce872ed9d752807f29</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p><strong>Dummy</strong></p>
<p>对象被四处传递，但是从不被真正使用。通常他们只是用来填充参数列表。</p>
<p><strong>Fake</strong><br>Fakes are objects that have working implementations, but not same as production one. Usually they take some shortcut and have simplified version of production code.Fake 是那些包含了生产环境下具体实现的简化版本的对象。（用于Test的测试实现类）</p>
<p><strong>Stub</strong></p>
<p>Stub is an object that holds predefined data and uses it to answer calls during tests. It is used when we cannot or don’t want to involve objects that would answer with real data or have undesirable side effects.Stub 代指那些包含了预定义好的数据并且在测试时返回给调用者的对象。Stub 常被用于我们不希望返回真实数据或者造成其他副作用的场景。（提供Query数据的对象）</p>
<p>stub是state-based，关注的是输入和输出。</p>
<p>stub意为踩熄</p>
<p><strong>Mock</strong></p>
<p>Mocks are objects that register calls they receive. In test assertion we can verify on Mocks that all expected actions were performed.Mocks 代指那些仅记录它们的调用信息的对象，在测试断言中我们需要验证 Mocks 被进行了符合期望的调用。(模拟行为的对象)</p>
<p>mock是interaction-based，关注的是交互过程。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26942686">https://zhuanlan.zhihu.com/p/26942686</a></p>
<h3 id="Classical-和-Mockist-TDD-测试风格"><a href="#Classical-和-Mockist-TDD-测试风格" class="headerlink" title="Classical 和 Mockist  TDD 测试风格"></a>Classical 和 Mockist  TDD 测试风格</h3><p>验证状态 vs 验证行为</p>
<h3 id="SUT-amp-UUT-amp-AUT"><a href="#SUT-amp-UUT-amp-AUT" class="headerlink" title="SUT &amp; UUT &amp; AUT"></a>SUT &amp; UUT &amp; AUT</h3><p>SUT（system under test，被测试系统）</p>
<p>UUT（unit under test，被测试单元）</p>
<p>AUT（application under test，被测试应用软件）</p>
<h3 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h3><ol>
<li><p>《单元测试之道》</p>
</li>
<li><p>《修改代码的艺术》</p>
</li>
<li><p>Mocks Aren’t Stubs</p>
</li>
</ol>
<h2 id="项目实践"><a href="#项目实践" class="headerlink" title="项目实践"></a>项目实践</h2><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/67801427">https://zhuanlan.zhihu.com/p/67801427</a></p>
<p><a target="_blank" rel="noopener" href="http://tengj.top/2017/12/28/springboot12/">http://tengj.top/2017/12/28/springboot12/</a></p>
<h3 id="场景一、测试控制层"><a href="#场景一、测试控制层" class="headerlink" title="场景一、测试控制层"></a>场景一、测试控制层</h3><h5 id="前置步骤"><a href="#前置步骤" class="headerlink" title="前置步骤"></a>前置步骤</h5><ol>
<li>生成<code>TargetController</code>的单元测试类<code>TargetControllerTest</code>（一般包括整个controller的所有方法的testCase）</li>
</ol>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>2. 生成目标方法<code>targetMethod</code>的单元测试方法<code>testTargetMethod</code><br>=======<br>2. 生成<code>targetMethod</code>的单元测试方法<code>testTargetMethod</code></p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>1bd18958d9aa8a5bf6a3acce872ed9d752807f29</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<ol start="3">
<li><p>注解声明单元测试类</p>
<ol>
<li>方式一</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明测试是在spring环境下运行的，这样就可以启用Spring的相关支持。</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="comment">// 注解负责扫描配置来构建测试用的Spring上下文环境。它默认搜索@SpringBootConfiguration类，除非我们通过classes属性指定配置类，或者通过自定义内嵌的@Configuration类来指定配置。</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>方式二</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="comment">// 实例化一个MockMvc的bean + 可指定只实例化某一到多个Controller（但是同样也会遵从配置类的注解去做更多的工作）</span></span><br><span class="line"><span class="meta">@WebMvcTest(AppCustomerController.class)</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>准备MockMvc对象</p>
<ol>
<li><p>方式一</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> WebApplicationContext wac;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mvc = MockMvcBuilders.webAppContextSetup(wac).build(); <span class="comment">//初始化MockMvc对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>方式二</p>
<ol>
<li>可直接使用@WebMvcTest实例化的mockMvcBean</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MockMvc mvc;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>只实例化目标类，避免其他无关类的实例化开销（自定义内嵌的@Configuration类来指定配置）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;xxx&quot;,</span></span><br><span class="line"><span class="meta">        useDefaultFilters = false,</span></span><br><span class="line"><span class="meta">        includeFilters = @ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">                type = FilterType.REGEX,</span></span><br><span class="line"><span class="meta">                pattern = &#123;&quot;xxx.TargetController&quot;&#125;)</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerConfig</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>解决TargetController被测对象的其他依赖问题</p>
</li>
<li><p>将测试目标的所有依赖bean声明为<strong>模拟的bean</strong>，这些模拟的bean将<strong>被注入测试目标bean</strong>。</p>
</li>
<li><p>构建MockHttpSession，解决请求过程中的用户验证问题</p>
</li>
<li><p>绝大部分的方法受限于公司封装的底层框架，必须实例化对应的bean，且为带参构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内部嵌套javaConfig类</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SpringContext <span class="title">springContext</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SpringContext(beanFactory); <span class="comment">// 由SqlContext实例化</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@MockBean</span></span><br><span class="line">BaseService baseService;</span><br><span class="line"><span class="meta">@MockBean</span></span><br><span class="line">CustomerSessionService customerSessionService;</span><br></pre></td></tr></table></figure></li>
<li><p>Mockito.spy()方法模拟出来的对象，调用该模拟对象的方法时，若该方法没有被”打桩“（预设），则会实际调用该方法真实逻辑。相比Mockito.mock()出来的模拟对象，若调用mock对象的方法没有被打桩，则返回默认值。</p>
</li>
<li><p>doReturn().when()与when().thenReturn()</p>
<ol>
<li>spy模拟对象<ol>
<li>when(…) thenReturn(…)会调用真实的方法</li>
<li> doReturn(…) when(…) 不会调用真实方法</li>
</ol>
</li>
</ol>
</li>
<li><p>2.1.0版本以前的<strong>Mockito</strong>是<strong>不能mock final类和final方法的</strong>，之后的也要通过配置一些相关文件才行(<a target="_blank" rel="noopener" href="https://github.com/mockito/mockito/wiki/What's-new-in-Mockito-2#mock-the-unmockable-opt-in-mocking-of-final-classesmethods">Mock the unmockable: opt-in mocking of final classes/methods</a>)。因此，它的补充框架PowerMock也应运而生。</p>
<ol>
<li>创建配置文件 src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker</li>
<li>文件内容：mock-maker-inline</li>
</ol>
</li>
</ol>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>12. powerMock（未实践）<br>=======<br>12. powerMock</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>1bd18958d9aa8a5bf6a3acce872ed9d752807f29</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(PowerMockRunner.class)</span> <span class="comment">// 替代SpringRunner.class</span></span><br><span class="line"><span class="comment">// // powermock使用了自定义的PowerMockRunner，与spring集成时，可以代理至SpringJUnit4ClassRunner。</span></span><br><span class="line"><span class="meta">@PowerMockRunnerDelegate(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">// @PowerMockRunnerDelegate(Parameterized.class)</span></span><br><span class="line"><span class="meta">@PrepareForTest(&#123;StaticService.class&#125;)</span> <span class="comment">// 包含静态类的方法</span></span><br></pre></td></tr></table></figure>
</code></pre>
<ol start="13">
<li>powerMock + org.mockito.plugins.MockMaker 冲突问题<ol>
<li>org.mockito.internal.configuration.plugins.PluginLoader：java.lang.ClassNotFoundException: mock-maker-inline</li>
<li>删掉扩展文件后：java.lang.NoSuchMethodError: org.mockito.MockingDetails.getMockCreationSettings()</li>
</ol>
</li>
<li>@Mock 和 @InjectMocks 搭配使用（而非@MockBean）</li>
</ol>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>    1. 而 @MockBean是 springBootTest提供的注解，用于将响应的bean注册到spring容器（且可指定beanName）<br>=======<br>    1. @MockBean是 springBootTest提供的注解，用于将响应的bean注册到spring容器（且可指定beanName）</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>1bd18958d9aa8a5bf6a3acce872ed9d752807f29</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MockBean(name = &quot;guide.SgGuide&quot;)</span></span><br><span class="line">SgGuide sgGuide;</span><br></pre></td></tr></table></figure>
</code></pre>
<ol start="16">
<li><p>ArgumentMatchers.any() vs Mockito.any() 是同一个东西，<strong>Mockito 继承了 ArgumentMatchers</strong></p>
</li>
<li><p>doxxx().when() 不能用于 @MockBean 场景下??? （given().willReturn()）</p>
</li>
<li><p><strong>mockMvc添加过滤器</strong></p>
<ol>
<li>mMockMvc = MockMvcBuilders.webAppContextSetup(context).addFilter(new UserFilter()).build();</li>
</ol>
</li>
</ol>
<p><strong>参考链接：</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/27313846/answer/853193909?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=983101242913976320&amp;utm_content=group2_Answer&amp;utm_campaign=shareopn">https://www.zhihu.com/question/27313846/answer/853193909?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=983101242913976320&amp;utm_content=group2_Answer&amp;utm_campaign=shareopn</a></p>

    </div>

    
    
    
        

<!-- JS库 clipboard 拷贝内容到粘贴板-->
<script src="https://cdn.bootcss.com/clipboard.js/2.0.1/clipboard.min.js"></script>
<!-- JS库 sweetalert 显示提示信息-->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>yuye.Huang
  </li>

  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://huangyuye.github.io/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" title="单元测试">https://huangyuye.github.io/2020/09/09/Java/知识库/软件开发流程/20200909-单元测试/</a>
  </li>

  <!-- 引用链接 -->
  <!-- 
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://huangyuye.github.io/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" title="单元测试"
      >https://huangyuye.github.io/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</a
    >
    <span class="copy-path" title="点击复制引用链接"
      ><i
        style="cursor: pointer"
        class="fa fa-clipboard"
        data-clipboard-text="[yuye.Huang's Blog | 单元测试](https://huangyuye.github.io/2020/09/09/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200909-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/)"
        aria-label="复制成功啦~"
      ></i
    ></span>
  </li>
  --> 

  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

<script>
  var clipboard = new ClipboardJS(".fa-clipboard");
  clipboard.on("success", function(target) {
    var message = document.createElement("div");
    message.innerHTML =
      '<i class="fa fa-check-circle message-icon"></i><span class="message-content">' +
      target.trigger.getAttribute("aria-label") +
      "</span>";
    swal({
      content: message,
      className: "copy-success-message",
      timer: 1000,
      button: false
    });
  });
</script>


      <!--  文章结束语 -->
      <div>
        
          <div>
    <div>
        
        <div style="text-align:center;color: #ccc;font-size:14px;">-----------------------<span style="margin: 0 10px;">本文结束</span><i class="fa fa-paw"></i><span style="margin: 0 10px;">感谢您的阅读</span>-----------------------</div>
        
    </div>
</div>
        
      </div>

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/09/06/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/20200906-Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8BCPU%E7%BC%93%E5%AD%98/" rel="prev" title="Java并发编程之CPU缓存">
      <i class="fa fa-chevron-left"></i> Java并发编程之CPU缓存
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/09/14/Java/%E7%9F%A5%E8%AF%86%E5%BA%93/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/20200914-Excel%E6%93%8D%E4%BD%9C_TODO/" rel="next" title="Excel操作_TODO">
      Excel操作_TODO <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">1.</span> <span class="nav-text">如何进行单元测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A6%82%E5%BF%B5"><span class="nav-number">2.</span> <span class="nav-text">单元测试概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6"><span class="nav-number">2.1.</span> <span class="nav-text">单元测试框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#junit"><span class="nav-number">2.1.1.</span> <span class="nav-text">junit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#testNG"><span class="nav-number">2.1.2.</span> <span class="nav-text">testNG</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E6%A1%86%E6%9E%B6"><span class="nav-number">2.2.</span> <span class="nav-text">模拟框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#EasyMock"><span class="nav-number">2.2.1.</span> <span class="nav-text">EasyMock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mockito-amp-JMockit"><span class="nav-number">2.2.2.</span> <span class="nav-text">Mockito &amp; JMockit</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%88%E8%BF%9B%E8%A1%8CStub%EF%BC%9Awhen-mock-someMethod-then"><span class="nav-number"></span> <span class="nav-text">先进行Stub：when(mock.someMethod()).then()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mockito-Vs-JMockit"><span class="nav-number">0.0.1.</span> <span class="nav-text">Mockito Vs JMockit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PowerMock"><span class="nav-number">0.0.2.</span> <span class="nav-text">PowerMock</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E7%9A%84mock%E6%A1%86%E6%9E%B6"><span class="nav-number">0.1.</span> <span class="nav-text">结合项目框架使用的mock框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%AD%E8%A8%80"><span class="nav-number">0.2.</span> <span class="nav-text">断言</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AssertJ-Hamcrest"><span class="nav-number">0.2.1.</span> <span class="nav-text">AssertJ &#x2F; Hamcrest</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Unit"><span class="nav-number">0.3.</span> <span class="nav-text">Spring Unit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%AD%E8%A8%80JSON%E5%93%8D%E5%BA%94"><span class="nav-number">0.4.</span> <span class="nav-text">断言JSON响应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JSONAssert-JSONPath"><span class="nav-number">0.4.1.</span> <span class="nav-text">JSONAssert &#x2F; JSONPath</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87"><span class="nav-number">0.5.</span> <span class="nav-text">测试覆盖率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jenkins"><span class="nav-number">0.6.</span> <span class="nav-text">jenkins</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-Doubles%EF%BC%9AFakes%E3%80%81Mocks-%E4%BB%A5%E5%8F%8A-Stubs"><span class="nav-number">0.7.</span> <span class="nav-text">Test Doubles：Fakes、Mocks 以及 Stubs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Classical-%E5%92%8C-Mockist-TDD-%E6%B5%8B%E8%AF%95%E9%A3%8E%E6%A0%BC"><span class="nav-number">0.8.</span> <span class="nav-text">Classical 和 Mockist  TDD 测试风格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SUT-amp-UUT-amp-AUT"><span class="nav-number">0.9.</span> <span class="nav-text">SUT &amp; UUT &amp; AUT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="nav-number">0.10.</span> <span class="nav-text">扩展阅读</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.</span> <span class="nav-text">项目实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">1.1.</span> <span class="nav-text">参考链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E4%B8%80%E3%80%81%E6%B5%8B%E8%AF%95%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="nav-number">1.2.</span> <span class="nav-text">场景一、测试控制层</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">前置步骤</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <!-- 添加点击头像-主页跳转 --> 
  <a href="/">
    <img class="site-author-image" itemprop="image" alt="yuye.Huang"
      src="/images/avatar.jpg">
  </a>
  <p class="site-author-name" itemprop="name">yuye.Huang</p>
  <div class="site-description" itemprop="description">想要成为酷酷的软件开发者</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/huangyuye" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;huangyuye" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:747776824@qq.com" title="E-Mail → mailto:747776824@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fas fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.yuque.com/huangyuye/qzf3af" title="https:&#x2F;&#x2F;www.yuque.com&#x2F;huangyuye&#x2F;qzf3af" rel="noopener" target="_blank">语雀</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">

  <!--
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">true</span>
  -->
    <!-- <span class="post-meta-divider">|</span> -->
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">148k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:14</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"UUUWSLrMNACz8vh8qf2aAksw-gzGzoHsz","app_key":"Jm3XS0ISb48hvvgbTu0qy3G9","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

   
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script>
<script>
  function timer() {
    var ages = moment.preciseDiff(moment(),moment(20210520,"YYYYMMDD"));
    ages = ages.replace(/years?/, "年");
    ages = ages.replace(/months?/, "月");
    ages = ages.replace(/days?/, "天");
    ages = ages.replace(/hours?/, "小时");
    ages = ages.replace(/minutes?/, "分");
    ages = ages.replace(/seconds?/, "秒");
    ages = ages.replace(/\d+/g, '<span style="color:#1890ff">$&</span>');
    div.innerHTML = `我已在此等候你 ${ages}`;
  } 
  var div = document.createElement("div");
  //插入到copyright之后
  var copyright = document.querySelector(".copyright");
  document.querySelector(".footer-inner").insertBefore(div, copyright.nextSibling);
  timer();
  setInterval("timer()",1000)
</script>


 
<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>


 

<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'UUUWSLrMNACz8vh8qf2aAksw-gzGzoHsz',
      appKey     : 'Jm3XS0ISb48hvvgbTu0qy3G9',
      placeholder: "建议在上方留下昵称和邮箱信息，以便收到回复通知~",
      avatar     : '/images/avatar.jpg',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
